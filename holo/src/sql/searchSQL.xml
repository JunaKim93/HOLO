<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="search">

	<select id="getBoardSearchRplList" resultType="searchRplDTO" parameterType="HashMap">
		select * from( 
			select articlenum, id, content, regDate, rownum r from(
				select articlenum, id, content, regDate from( 
					select articlenum, id, content, regDate from(
					select * from ${board} where ${choice} like '%' || #{search} || '%')
				) order by regDate desc))
		<![CDATA[ where r >= ${start} and r <= ${end}]]>
	</select>	

	<select id="getBoardSearchList" resultType="searchDTO" parameterType="HashMap">
		select * from( 
			select articleNum, category_a,category_b, id, subject, content, viewCount, regDate, rownum r from(
				select articleNum, category_a,category_b, id, subject, content, viewCount, regDate from( 
					select articleNum, category_a,category_b, id, subject, content, viewCount, regDate from(
					select * from ${board} where ${choice} like '%' || #{search} || '%')
				) order by regDate desc))
		<![CDATA[ where r >= ${start} and r <= ${end}]]>
	</select>	
	
	<select id="getSearchRplList" resultType="searchRplDTO" parameterType="HashMap">
		select * from( 
			select articlenum, id, content, regDate, rownum r from(
				select articlenum, id, content, regDate from( 
					select articlenum, id, content, regDate from(
					select * from diyReply where ${choice} like '%' || #{search} || '%')
					union
					select articlenum, id, content, regDate from(
					select * from marketReply where ${choice} like '%' || #{search} || '%')
					union
					select articlenum, id, content, regDate from(
					select * from communityReply where ${choice} like '%' || #{search} || '%')
					union
					select articlenum, id, content, regDate from(
					select * from infoRep where ${choice} like '%' || #{search} || '%')
				) order by regDate desc))
		<![CDATA[ where r >= ${start} and r <= ${end}]]>
	</select>	
	
	<select id="getSearchList" resultType="searchDTO" parameterType="HashMap">
		select * from( 
			select articleNum, category_a,category_b, id, subject, content, viewCount, regDate, rownum r from(
				select articleNum, category_a,category_b, id, subject, content, viewCount, regDate from( 
					select articleNum, category_a,category_b, id, subject, content, viewCount, regDate from(
					select * from diyBoard where ${choice} like '%' || #{search} || '%')
					union
					select articleNum, category_a,category_b, id, subject, content, viewCount, regDate from(
					select * from marketBoard where ${choice} like '%' || #{search} || '%')
					union
					select articleNum, category_a,category_b, id, subject, content, viewCount, regDate from(
					select * from communityBoard where ${choice} like '%' || #{search} || '%')
					union
					select articleNum, category_a,category_b, id, subject, content, viewCount, regDate from(
					select * from infoBoard where ${choice} like '%' || #{search} || '%')
				) order by regDate desc))
		<![CDATA[ where r >= ${start} and r <= ${end}]]>
	</select>	


	<select id="boardSearchCount" resultType="int" parameterType="HashMap">
		select count(*) as count from ${board} where ${choice} like '%' || #{search} || '%'
	</select>
	
	<select id="searchCount" resultType="int" parameterType="HashMap">
	 	select sum(count) from (
			select count(*) as count from diyBoard where ${choice} like '%' || #{search} || '%'
			union
			select count(*) as count from infoBoard where ${choice} like '%' || #{search} || '%'
			union
			select count(*) as count from marketBoard where ${choice} like '%' || #{search} || '%'
			union
			select count(*) as count from communityBoard where ${choice} like '%' || #{search} || '%'
			)
	</select>

	<select id="boardSearchRplCount" resultType="int" parameterType="HashMap">
		select count(*) as count from ${board} where ${choice} like '%' || #{search} || '%'
	</select>
			
	<select id="searchRplCount" resultType="int" parameterType="HashMap">
	 	select sum(count) from (
			select count(*) as count from diyReply where ${choice} like '%' || #{search} || '%'
			union
			select count(*) as count from infoRep where ${choice} like '%' || #{search} || '%'
			union
			select count(*) as count from marketReply where ${choice} like '%' || #{search} || '%'
			union
			select count(*) as count from communityReply where ${choice} like '%' || #{search} || '%'
			)
	</select>
</mapper>


	

